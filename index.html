<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<title>Eat Bertie Bott's Every Flavor Beans</title>
<link href="https://fonts.googleapis.com/css?family=EB+Garamond|Henny+Penny" rel="stylesheet">
<link href="main.css?7" rel="stylesheet">

<body>

<header><h2>Bertie Bott's <span class="star">✶</span> Every Flavor Beans</h2></header>

<article>

<aside>
<div id="close-mobile-menu">×</div>
<h3>Hogwarts House</h3>
<p>
<select>
    <option value="">None
    <option value="gryffindor">Gryffindor
    <option value="slytherin">Slytherin
    <option value="ravenclaw">Ravenclaw
    <option value="hufflepuff">Hufflepuff
</select>
</p>
</aside>

<section>
<h4>✶ Appendix <abbr>i</abbr> ✶</h4>
<h1>Eating Bertie Bott's</h1>

<main>
<p>You open a bag of Bertie Bott's every flavor beans</p>
</main>

<fieldset>
    <p><button onclick="eat()">Eat a bean</button></p>
</fieldset>

</section>

</article>

<script>
var data, xhr = new XMLHttpRequest(), flavors, lineCount = 0;
xhr.open("GET", "flavors.json");
xhr.onload = function (e) {
    data = JSON.parse(xhr.response);
    flavors = data.flavors.length;
};
xhr.send();

Array.prototype.random = function () {
    return this[Math.floor(Math.random() * this.length)];
};

function eat() {
    var chosen = data.flavors.random(), beanName, beanObj, beanDesc, totalFlavor, p, main, text;
    beanName = Object.keys(chosen)[0];
    beanObj = chosen[Object.keys(chosen)[0]];

    main = document.querySelector("main");

    if (lineCount === 0) {
        p = document.querySelector("main p");
        text = "You open a bag of Bertie Bott's every flavor beans. Closing your eyes, you pick one at random";
        p.textContent = text;
    }
    text = ". It tastes like "
    if (lineCount === 1) {
        p = document.querySelector("main p");
        text = document.createTextNode(". You dare to try another");
        p.appendChild(text);
        text = ". This one tastes like ";
    }
    if (lineCount === 2) {
        p = document.createElement("p");
        p.textContent = "Undeterred, you continue to dig into the bag";
        main.appendChild(p);
        text = ". The next one tastes like "
    }
    if (lineCount === 3) {
        text = ". You taste beans the flavor of ";
    }
    if (lineCount > 3) {
        text = ", ";
    }
    p = document.querySelector("main p:last-child");
    text = document.createTextNode(text + beanName);
    p.appendChild(text);

    document.querySelector("fieldset").scrollIntoView(false);
    lineCount += 1;
    //main.scrollTo(0, main.innerHeight);
    // document.getElementById("bean").textContent = "It tastes like… " + beanName + ".";
    /*beanDesc = document.getElementById("bean-desc");
    beanDesc.textContent = "";

    if (beanObj.sweet > 1) {
        beanDesc.textContent = "It's very sweet!";
    }
    if (beanObj.sour > 1) {
        beanDesc.textContent = "Whoa that's sour!";
    }
    if (beanObj.hot > 1) {
        beanDesc.textContent = "Ah, ah, ah, spicy!";
    }
    if (beanObj.putrid > 1) {
        beanDesc.textContent = "Barf!";
    }
    totalFlavor = beanObj.sweet + beanObj.sour + beanObj.hot + beanObj.putrid + beanObj.salty + beanObj.savory + beanObj.bitter;

    if (totalFlavor > 3) {
        beanDesc.textContent = "It's quite flavourful.";
    }

    if (totalFlavor === 0) {
        beanDesc.textContent = "So bland.";
    }*/
}

function setHouse() {
    var className = location.hash,
        html = document.querySelector("html");

    if (className) {
        html.className = className.slice(1);
    } else {
        html.className = "";
    }
}
window.onhashchange = setHouse;
window.onload = function () {
    if (location.hash) {
        document.querySelector("select").value = location.hash.slice(1);
    }
    setHouse();
}
document.querySelector("select").onchange = function () {
    location.href = "#" + this.value;
};
document.querySelector("select").onchange = function () {
    location.href = "#" + this.value;
};
</script>
